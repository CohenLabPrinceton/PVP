

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>controller module &mdash; PVP 0.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/pvp_theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/_static/pvp_theme.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="coordinator module" href="coordinator.html" />
    <link rel="prev" title="fashion" href="pvp.common.fashion.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> PVP
          

          
          </a>

          
            
            
              <div class="version">
                0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="control_overview.html">Control Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Hardware:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hardware.html">Hardware Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Software:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common.html">common</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinator.html">coordinator</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">io</a></li>
<li class="toctree-l1"><a class="reference internal" href="alarm.html">alarm</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Ventilator Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="datasheets.html">Datasheets &amp; Manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="specs.html">Specifications</a></li>
</ul>
<p class="caption"><span class="caption-text">Meta:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog/index.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildthedocs.html">Building the Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_markdown.html">Markdown Example</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PVP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>controller module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/controller.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-pvp.controller.control_module">
<span id="controller-module"></span><h1>controller module<a class="headerlink" href="#module-pvp.controller.control_module" title="Permalink to this headline">¶</a></h1>
<p><strong>Classes</strong></p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.Balloon_Simulator" title="pvp.controller.control_module.Balloon_Simulator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Balloon_Simulator</span></code></a>(peep_valve)</p></td>
<td><p>Physics simulator for inflating a balloon with an attached PEEP valve.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase" title="pvp.controller.control_module.ControlModuleBase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ControlModuleBase</span></code></a>(save_logs, flush_every)</p></td>
<td><p>Abstract controller class for simulation/hardware.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleDevice" title="pvp.controller.control_module.ControlModuleDevice"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ControlModuleDevice</span></code></a>([save_logs, …])</p></td>
<td><p>Uses ControlModuleBase to control the hardware.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleSimulator" title="pvp.controller.control_module.ControlModuleSimulator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ControlModuleSimulator</span></code></a>([simulator_dt, …])</p></td>
<td><p>Controlling Simulation.</p></td>
</tr>
</tbody>
</table>
<p><strong>Functions</strong></p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.get_control_module" title="pvp.controller.control_module.get_control_module"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_control_module</span></code></a>([sim_mode, simulator_dt])</p></td>
<td><p>Generates control module.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt id="pvp.controller.control_module.ControlModuleBase">
<em class="property">class </em><code class="sig-prename descclassname">pvp.controller.control_module.</code><code class="sig-name descname">ControlModuleBase</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">save_logs</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)">bool</a></span> <span class="o">=</span> <span class="default_value">False</span></em>, <em class="sig-param"><span class="n">flush_every</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)">int</a></span> <span class="o">=</span> <span class="default_value">10</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Abstract controller class for simulation/hardware.</p>
<p>1. General notes:
All internal variables fall in three classes, denoted by the beginning of the variable:</p>
<p><strong>Methods</strong></p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.__analyze_last_waveform" title="pvp.controller.control_module.ControlModuleBase.__analyze_last_waveform"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__analyze_last_waveform</span></code></a>()</p></td>
<td><p>This goes through the last waveform, and updates the internal variables:       VTE, PEEP, PIP, PIP_TIME, I_PHASE, FIRST_PEEP and BPM.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.__calculate_control_signal_in" title="pvp.controller.control_module.ControlModuleBase.__calculate_control_signal_in"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__calculate_control_signal_in</span></code></a>(dt)</p></td>
<td><p>Calculates the PID control signal by:     - Combining the the three gain parameters.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.__get_PID_error" title="pvp.controller.control_module.ControlModuleBase.__get_PID_error"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__get_PID_error</span></code></a>(ytarget, yis, dt, RC)</p></td>
<td><p>Calculates the three terms for PID control.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.__save_values" title="pvp.controller.control_module.ControlModuleBase.__save_values"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__save_values</span></code></a>()</p></td>
<td><p>Helper function to reorganize key parameters in the main PID control loop, into a <cite>SensorValues</cite> object, that can be stored in the logfile, using a method from the DataLogger.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.__start_new_breathcycle" title="pvp.controller.control_module.ControlModuleBase.__start_new_breathcycle"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__start_new_breathcycle</span></code></a>()</p></td>
<td><p>Some housekeeping.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.__test_for_alarms" title="pvp.controller.control_module.ControlModuleBase.__test_for_alarms"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__test_for_alarms</span></code></a>()</p></td>
<td><p>Implements tests that are to be executed in the main control loop:     - Test for HAPA     - Test for Technical Alert, making sure sensor values are plausible     - Test for Technical Alert, make sure continuous in contact Currently: Alarms are time.time() of first occurance.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase._PID_update" title="pvp.controller.control_module.ControlModuleBase._PID_update"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_PID_update</span></code></a>(dt)</p></td>
<td><p>This instantiates the PID control algorithms.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.__init__" title="pvp.controller.control_module.ControlModuleBase.__init__"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code></a>(save_logs, flush_every)</p></td>
<td><p>Initializes the ControlModuleBase class.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase._control_reset" title="pvp.controller.control_module.ControlModuleBase._control_reset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_control_reset</span></code></a>()</p></td>
<td><p>Resets the internal controller cycle to zero, i.e.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase._controls_from_COPY" title="pvp.controller.control_module.ControlModuleBase._controls_from_COPY"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_controls_from_COPY</span></code></a>()</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase._get_control_signal_in" title="pvp.controller.control_module.ControlModuleBase._get_control_signal_in"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_get_control_signal_in</span></code></a>()</p></td>
<td><p>Produces the INSPIRATORY control-signal that has been calculated in <cite>__calculate_control_signal_in(dt)</cite></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase._get_control_signal_out" title="pvp.controller.control_module.ControlModuleBase._get_control_signal_out"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_get_control_signal_out</span></code></a>()</p></td>
<td><p>Produces the EXPIRATORY control-signal for the different states, i.e.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase._initialize_set_to_COPY" title="pvp.controller.control_module.ControlModuleBase._initialize_set_to_COPY"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_initialize_set_to_COPY</span></code></a>()</p></td>
<td><p>Makes a copy of internal variables.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase._sensor_to_COPY" title="pvp.controller.control_module.ControlModuleBase._sensor_to_COPY"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_sensor_to_COPY</span></code></a>()</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase._start_mainloop" title="pvp.controller.control_module.ControlModuleBase._start_mainloop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_start_mainloop</span></code></a>()</p></td>
<td><p>Prototype method to start main PID loop.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.get_alarms" title="pvp.controller.control_module.ControlModuleBase.get_alarms"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_alarms</span></code></a>()</p></td>
<td><p>A method callable from the outside to get a copy of the alarms, that the controller checks: High airway pressure, and technical alarms.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.get_control" title="pvp.controller.control_module.ControlModuleBase.get_control"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_control</span></code></a>(control_setting_name)</p></td>
<td><p>A method callable from the outside to get current control settings.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.get_heartbeat" title="pvp.controller.control_module.ControlModuleBase.get_heartbeat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_heartbeat</span></code></a>()</p></td>
<td><p>Returns an independent heart-beat of the controller, i.e.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.get_past_waveforms" title="pvp.controller.control_module.ControlModuleBase.get_past_waveforms"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_past_waveforms</span></code></a>()</p></td>
<td><p>Public method to return a list of past waveforms from <cite>__cycle_waveform_archive</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.get_sensors" title="pvp.controller.control_module.ControlModuleBase.get_sensors"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_sensors</span></code></a>()</p></td>
<td><p>A method callable from the outside to get a copy of sensorValues</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.interrupt" title="pvp.controller.control_module.ControlModuleBase.interrupt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">interrupt</span></code></a>()</p></td>
<td><p>If the controller seems stuck, this generates a new thread, and starts the main loop.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.is_running" title="pvp.controller.control_module.ControlModuleBase.is_running"><code class="xref py py-obj docutils literal notranslate"><span class="pre">is_running</span></code></a>()</p></td>
<td><p>Public Method to assess whether the main loop thread is running.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.set_breath_detection" title="pvp.controller.control_module.ControlModuleBase.set_breath_detection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_breath_detection</span></code></a>(breath_detection)</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.set_control" title="pvp.controller.control_module.ControlModuleBase.set_control"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_control</span></code></a>(control_setting)</p></td>
<td><p>A method callable from the outside to set alarms.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.start" title="pvp.controller.control_module.ControlModuleBase.start"><code class="xref py py-obj docutils literal notranslate"><span class="pre">start</span></code></a>()</p></td>
<td><p>Method to start <cite>_start_mainloop</cite> as a thread.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase.stop" title="pvp.controller.control_module.ControlModuleBase.stop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stop</span></code></a>()</p></td>
<td><p>Method to stop the main loop thread, and close the logfile.</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><ul class="simple">
<li><p><cite>COPY_varname</cite>: These are copies (for safe threading purposes) that are regularly sync’ed with internal variables.</p></li>
<li><p><cite>__varname</cite>:    These are variables only used in the ControlModuleBase-Class</p></li>
<li><p><cite>_varname</cite>:     These are variables used in derived classes.</p></li>
</ul>
</div></blockquote>
<p>2. Set and get values.
Internal variables should only to be accessed though the <a href="#id1"><span class="problematic" id="id2">set_</span></a> and <a href="#id3"><span class="problematic" id="id4">get_</span></a> functions.</p>
<blockquote>
<div><p>These functions act on COPIES of internal variables (<cite>__</cite> and <cite>_</cite>), that are sync’d every few
iterations. How often this is done is adjusted by the variable
<cite>self._NUMBER_CONTROLL_LOOPS_UNTIL_UPDATE</cite>. To avoid multiple threads manipulating the same
variables at the same time, every manipulation of <cite>COPY_</cite> is surrounded by a thread lock.</p>
</div></blockquote>
<dl class="simple">
<dt>Public Methods:</dt><dd><ul class="simple">
<li><p><cite>get_sensors()</cite>:                     Returns a copy of the current sensor values.</p></li>
<li><p><cite>get_alarms()</cite>:                      Returns a List of all alarms, active and logged</p></li>
<li><p><cite>get_control(ControlSetting)</cite>:       Sets a controll-setting. Is updated at latest within self._NUMBER_CONTROLL_LOOPS_UNTIL_UPDATE</p></li>
<li><p><cite>get_past_waveforms()</cite>:              Returns a List of waveforms of pressure and volume during at the last N breath cycles, N&lt;self. _RINGBUFFER_SIZE, AND clears this archive.</p></li>
<li><p><cite>start()</cite>:                           Starts the main-loop of the controller</p></li>
<li><p><cite>stop()</cite>:                            Stops the main-loop of the controller</p></li>
<li><p><cite>set_control()</cite>:                     Set the control</p></li>
<li><p><cite>interrupt()</cite>:                       Interrupt the controller, and re-spawns the thread. Used to restart a stuck controller</p></li>
<li><p><cite>is_running()</cite>:                      Returns a bool whether the main-thread is running</p></li>
<li><p><cite>get_heartbeat()</cite>:                   Returns a heartbeat, more specifically, the continuously increasing iteration-number of the main control loop.</p></li>
</ul>
</dd>
</dl>
<p>Initializes the ControlModuleBase class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>save_logs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Should sensor data and controls should be saved with the <a class="reference internal" href="pvp.common.loggers.html#pvp.common.loggers.DataLogger" title="pvp.common.loggers.DataLogger"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataLogger</span></code></a>? Defaults to False.</p></li>
<li><p><strong>flush_every</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Flush and rotate logs every n breath cycles. Defaults to 10.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>alert</strong> – [description]</p>
</dd>
</dl>
<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">save_logs</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)">bool</a></span> <span class="o">=</span> <span class="default_value">False</span></em>, <em class="sig-param"><span class="n">flush_every</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)">int</a></span> <span class="o">=</span> <span class="default_value">10</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.__init__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes the ControlModuleBase class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>save_logs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Should sensor data and controls should be saved with the <a class="reference internal" href="pvp.common.loggers.html#pvp.common.loggers.DataLogger" title="pvp.common.loggers.DataLogger"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataLogger</span></code></a>? Defaults to False.</p></li>
<li><p><strong>flush_every</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Flush and rotate logs every n breath cycles. Defaults to 10.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>alert</strong> – [description]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase._initialize_set_to_COPY">
<code class="sig-name descname">_initialize_set_to_COPY</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase._initialize_set_to_COPY"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase._initialize_set_to_COPY" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a copy of internal variables. This is used to facilitate threading</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase._sensor_to_COPY">
<code class="sig-name descname">_sensor_to_COPY</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase._sensor_to_COPY"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase._sensor_to_COPY" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase._controls_from_COPY">
<code class="sig-name descname">_controls_from_COPY</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase._controls_from_COPY"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase._controls_from_COPY" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.__analyze_last_waveform">
<code class="sig-name descname">__analyze_last_waveform</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.__analyze_last_waveform" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>This goes through the last waveform, and updates the internal variables:</dt><dd><p>VTE, PEEP, PIP, PIP_TIME, I_PHASE, FIRST_PEEP and BPM.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.get_sensors">
<code class="sig-name descname">get_sensors</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="pvp.common.message.html#pvp.common.message.SensorValues" title="pvp.common.message.SensorValues">pvp.common.message.SensorValues</a><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.get_sensors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.get_sensors" title="Permalink to this definition">¶</a></dt>
<dd><p>A method callable from the outside to get a copy of sensorValues</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A set of current sensorvalues, handeled by the controller.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="pvp.common.message.html#pvp.common.message.SensorValues" title="pvp.common.message.SensorValues">SensorValues</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.get_alarms">
<code class="sig-name descname">get_alarms</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.8)">None</a><span class="p">, </span>Tuple<span class="p">[</span><a class="reference internal" href="pvp.alarm.html#pvp.alarm.alarm.Alarm" title="pvp.alarm.alarm.Alarm">pvp.alarm.alarm.Alarm</a><span class="p">]</span><span class="p">]</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.get_alarms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.get_alarms" title="Permalink to this definition">¶</a></dt>
<dd><p>A method callable from the outside to get a copy of the alarms, that the controller checks:
High airway pressure, and technical alarms.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A tuple of alarms</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>typing.Union[<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.8)">None</a>, typing.Tuple[<a class="reference internal" href="pvp.alarm.html#pvp.alarm.alarm.Alarm" title="pvp.alarm.alarm.Alarm">Alarm</a>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.set_control">
<code class="sig-name descname">set_control</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">control_setting</span><span class="p">:</span> <span class="n"><a class="reference internal" href="pvp.common.message.html#pvp.common.message.ControlSetting" title="pvp.common.message.ControlSetting">pvp.common.message.ControlSetting</a></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.set_control"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.set_control" title="Permalink to this definition">¶</a></dt>
<dd><p>A method callable from the outside to set alarms.
This updates the entries of COPY with new control values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>control_setting</strong> (<a class="reference internal" href="pvp.common.message.html#pvp.common.message.ControlSetting" title="pvp.common.message.ControlSetting"><em>ControlSetting</em></a>) – [description]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.get_control">
<code class="sig-name descname">get_control</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">control_setting_name</span><span class="p">:</span> <span class="n"><a class="reference internal" href="pvp.common.values.html#pvp.common.values.ValueName" title="pvp.common.values.ValueName">pvp.common.values.ValueName</a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="pvp.common.message.html#pvp.common.message.ControlSetting" title="pvp.common.message.ControlSetting">pvp.common.message.ControlSetting</a><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.get_control"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.get_control" title="Permalink to this definition">¶</a></dt>
<dd><p>A method callable from the outside to get current control settings.
This returns values of COPY to the outside world.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>control_setting_name</strong> (<a class="reference internal" href="pvp.common.values.html#pvp.common.values.ValueName" title="pvp.common.values.ValueName"><em>ValueName</em></a>) – The specific control asked for</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ControlSettings-Object that contains relevant data</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="pvp.common.message.html#pvp.common.message.ControlSetting" title="pvp.common.message.ControlSetting">ControlSetting</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.set_breath_detection">
<code class="sig-name descname">set_breath_detection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">breath_detection</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)">bool</a></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.set_breath_detection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.set_breath_detection" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.__get_PID_error">
<code class="sig-name descname">__get_PID_error</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ytarget</span></em>, <em class="sig-param"><span class="n">yis</span></em>, <em class="sig-param"><span class="n">dt</span></em>, <em class="sig-param"><span class="n">RC</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.__get_PID_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the three terms for PID control. Also takes a timestep “dt” on which the integral-term is smoothed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ytarget</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – target value of pressure</p></li>
<li><p><strong>yis</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – current value of pressure</p></li>
<li><p><strong>dt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – timestep</p></li>
<li><p><strong>RC</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – time constant for calculation of integral term.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.__calculate_control_signal_in">
<code class="sig-name descname">__calculate_control_signal_in</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dt</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.__calculate_control_signal_in" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Calculates the PID control signal by:</dt><dd><ul class="simple">
<li><p>Combining the the three gain parameters.</p></li>
<li><p>And smoothing the control signal with a moving window of three frames (~10ms)</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – timestep</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase._get_control_signal_in">
<code class="sig-name descname">_get_control_signal_in</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase._get_control_signal_in"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase._get_control_signal_in" title="Permalink to this definition">¶</a></dt>
<dd><p>Produces the INSPIRATORY control-signal that has been calculated in <cite>__calculate_control_signal_in(dt)</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the numerical control signal for the inspiratory prop valve</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase._get_control_signal_out">
<code class="sig-name descname">_get_control_signal_out</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase._get_control_signal_out"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase._get_control_signal_out" title="Permalink to this definition">¶</a></dt>
<dd><p>Produces the EXPIRATORY control-signal for the different states, i.e. open/close</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>numerical control signal for expiratory side: open (1) close (0)</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase._control_reset">
<code class="sig-name descname">_control_reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase._control_reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase._control_reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets the internal controller cycle to zero, i.e. restarts the breath cycle.
Used for autonomous breath detection.</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.__test_for_alarms">
<code class="sig-name descname">__test_for_alarms</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.__test_for_alarms" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Implements tests that are to be executed in the main control loop:</dt><dd><ul class="simple">
<li><p>Test for HAPA</p></li>
<li><p>Test for Technical Alert, making sure sensor values are plausible</p></li>
<li><p>Test for Technical Alert, make sure continuous in contact</p></li>
</ul>
</dd>
</dl>
<p>Currently: Alarms are time.time() of first occurance.</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.__start_new_breathcycle">
<code class="sig-name descname">__start_new_breathcycle</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.__start_new_breathcycle" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Some housekeeping. This has to be executed when the next breath cycles starts:</dt><dd><ul class="simple">
<li><p>starts new breathcycle</p></li>
<li><p>initializes newe __cycle_waveform</p></li>
<li><p>analyzes last breath waveform for PIP, PEEP etc. with <cite>__analyze_last_waveform()</cite></p></li>
<li><p>flushes the logfile</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase._PID_update">
<code class="sig-name descname">_PID_update</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dt</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase._PID_update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase._PID_update" title="Permalink to this definition">¶</a></dt>
<dd><p>This instantiates the PID control algorithms.
During the breathing cycle, it goes through the four states:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Rise to PIP, speed is controlled by flow (variable: <cite>__SET_PIP_GAIN</cite>)</p></li>
<li><p>Sustain PIP pressure</p></li>
<li><p>Quick fall to PEEP</p></li>
<li><p>Sustaint PEEP pressure</p></li>
</ol>
</div></blockquote>
<p>Once the cycle is complete, it checks the cycle for any alarms, and starts a new one.
A record of pressure/volume waveforms is kept and saved</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – timesstep since last update</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.__save_values">
<code class="sig-name descname">__save_values</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.__save_values" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to reorganize key parameters in the main PID control loop, into a <cite>SensorValues</cite> object,
that can be stored in the logfile, using a method from the DataLogger.</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.get_past_waveforms">
<code class="sig-name descname">get_past_waveforms</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.get_past_waveforms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.get_past_waveforms" title="Permalink to this definition">¶</a></dt>
<dd><p>Public method to return a list of past waveforms from <cite>__cycle_waveform_archive</cite>.
Note: After calling this function, archive is emptied! The format is</p>
<blockquote>
<div><ul class="simple">
<li><p>Returns a list of [Nx3] waveforms, of [time, pressure, volume]</p></li>
<li><p>Most recent entry is waveform_list[-1]</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>[Nx3] waveforms, of [time, pressure, volume]</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.8)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase._start_mainloop">
<code class="sig-name descname">_start_mainloop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase._start_mainloop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase._start_mainloop" title="Permalink to this definition">¶</a></dt>
<dd><p>Prototype method to start main PID loop. Will depend on simulation or device, specified below.</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.start">
<code class="sig-name descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to start <cite>_start_mainloop</cite> as a thread.</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.stop">
<code class="sig-name descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.stop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to stop the main loop thread, and close the logfile.</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.interrupt">
<code class="sig-name descname">interrupt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.interrupt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.interrupt" title="Permalink to this definition">¶</a></dt>
<dd><p>If the controller seems stuck, this generates a new thread, and starts the main loop.
No parameters have changed.</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.is_running">
<code class="sig-name descname">is_running</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.is_running"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.is_running" title="Permalink to this definition">¶</a></dt>
<dd><p>Public Method to assess whether the main loop thread is running.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Return true if and only if the main thread of controller is running.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleBase.get_heartbeat">
<code class="sig-name descname">get_heartbeat</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleBase.get_heartbeat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleBase.get_heartbeat" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an independent heart-beat of the controller, i.e. the internal loop counter incremented in <cite>_start_mainloop</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>exact value of <cite>self._loop_counter</cite></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)">int</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="pvp.controller.control_module.ControlModuleDevice">
<em class="property">class </em><code class="sig-prename descclassname">pvp.controller.control_module.</code><code class="sig-name descname">ControlModuleDevice</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">save_logs</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">flush_every</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">config_file</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleDevice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleDevice" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase" title="pvp.controller.control_module.ControlModuleBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">pvp.controller.control_module.ControlModuleBase</span></code></a></p>
<p>Uses ControlModuleBase to control the hardware.</p>
<p>Initializes the ControlModule for the physical system. Inherits methods from ControlModuleBase</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>save_logs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Should logs be kept? Defaults to True.</p></li>
<li><p><strong>flush_every</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – How often are log-files to be flushed, in units of main-loop-itertions? Defaults to 10.</p></li>
<li><p><strong>config_file</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Path to device config file, e.g. ‘pvp/io/config/dinky-devices.ini’. Defaults to None.</p></li>
</ul>
</dd>
</dl>
<p><strong>Methods</strong></p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleDevice.__init__" title="pvp.controller.control_module.ControlModuleDevice.__init__"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code></a>([save_logs, flush_every, config_file])</p></td>
<td><p>Initializes the ControlModule for the physical system.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleDevice._get_HAL" title="pvp.controller.control_module.ControlModuleDevice._get_HAL"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_get_HAL</span></code></a>()</p></td>
<td><p>Get sensor values from HAL, decorated with timeout.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleDevice._sensor_to_COPY" title="pvp.controller.control_module.ControlModuleDevice._sensor_to_COPY"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_sensor_to_COPY</span></code></a>()</p></td>
<td><p>Copies the current measurements to`COPY_sensor_values`, so that it can be queried from the outside.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleDevice._set_HAL" title="pvp.controller.control_module.ControlModuleDevice._set_HAL"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_set_HAL</span></code></a>(valve_open_in, valve_open_out)</p></td>
<td><p>Set Controls with HAL, decorated with a timeout.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleDevice._start_mainloop" title="pvp.controller.control_module.ControlModuleDevice._start_mainloop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_start_mainloop</span></code></a>()</p></td>
<td><p>This is the main loop.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleDevice.set_valves_standby" title="pvp.controller.control_module.ControlModuleDevice.set_valves_standby"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_valves_standby</span></code></a>()</p></td>
<td><p>This returns valves back to normal setting (in: closed, out: open)</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleDevice.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">save_logs</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">flush_every</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">config_file</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleDevice.__init__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleDevice.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes the ControlModule for the physical system. Inherits methods from ControlModuleBase</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>save_logs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Should logs be kept? Defaults to True.</p></li>
<li><p><strong>flush_every</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – How often are log-files to be flushed, in units of main-loop-itertions? Defaults to 10.</p></li>
<li><p><strong>config_file</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Path to device config file, e.g. ‘pvp/io/config/dinky-devices.ini’. Defaults to None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleDevice._sensor_to_COPY">
<code class="sig-name descname">_sensor_to_COPY</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleDevice._sensor_to_COPY"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleDevice._sensor_to_COPY" title="Permalink to this definition">¶</a></dt>
<dd><p>Copies the current measurements to`COPY_sensor_values`, so that it can be queried
from the outside.</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleDevice._set_HAL">
<code class="sig-name descname">_set_HAL</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">valve_open_in</span></em>, <em class="sig-param"><span class="n">valve_open_out</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleDevice._set_HAL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleDevice._set_HAL" title="Permalink to this definition">¶</a></dt>
<dd><p>Set Controls with HAL, decorated with a timeout.</p>
<p>As hardware communication is the speed bottleneck. this code is slightly optimized in so far as only changes are sent to hardware.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>valve_open_in</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – setting of the inspiratory valve; should be in range [0,100]</p></li>
<li><p><strong>valve_open_out</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – setting of the expiratory valve; should be 1/0 (open and close)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleDevice._get_HAL">
<code class="sig-name descname">_get_HAL</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleDevice._get_HAL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleDevice._get_HAL" title="Permalink to this definition">¶</a></dt>
<dd><p>Get sensor values from HAL, decorated with timeout.
As hardware communication is the speed bottleneck. this code is slightly optimized in so far as some sensors are
queried only in certain phases of the breatch cycle. This is done to run the primary PID loop as fast as possible:</p>
<blockquote>
<div><ul class="simple">
<li><p>pressure is always queried</p></li>
<li><p>Flow is queried only outside of inspiration</p></li>
<li><p>In addition, oxygen is only read every 5 seconds.</p></li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleDevice.set_valves_standby">
<code class="sig-name descname">set_valves_standby</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleDevice.set_valves_standby"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleDevice.set_valves_standby" title="Permalink to this definition">¶</a></dt>
<dd><p>This returns valves back to normal setting (in: closed, out: open)</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleDevice._start_mainloop">
<code class="sig-name descname">_start_mainloop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleDevice._start_mainloop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleDevice._start_mainloop" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the main loop. This method should be run as a thread (see the <cite>start()</cite> method in <cite>ControlModuleBase</cite>)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="pvp.controller.control_module.Balloon_Simulator">
<em class="property">class </em><code class="sig-prename descclassname">pvp.controller.control_module.</code><code class="sig-name descname">Balloon_Simulator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">peep_valve</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#Balloon_Simulator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.Balloon_Simulator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Physics simulator for inflating a balloon with an attached PEEP valve.
For math, see <a class="reference external" href="https://en.wikipedia.org/wiki/Two-balloon_experiment">https://en.wikipedia.org/wiki/Two-balloon_experiment</a></p>
<p><strong>Methods</strong></p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.Balloon_Simulator.OUupdate" title="pvp.controller.control_module.Balloon_Simulator.OUupdate"><code class="xref py py-obj docutils literal notranslate"><span class="pre">OUupdate</span></code></a>(variable, dt, mu, sigma, tau)</p></td>
<td><p>This is a simple function to produce an OU process on <cite>variable</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.Balloon_Simulator._reset" title="pvp.controller.control_module.Balloon_Simulator._reset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_reset</span></code></a>()</p></td>
<td><p>Resets Balloon to default settings.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.Balloon_Simulator.get_pressure" title="pvp.controller.control_module.Balloon_Simulator.get_pressure"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_pressure</span></code></a>()</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.Balloon_Simulator.get_volume" title="pvp.controller.control_module.Balloon_Simulator.get_volume"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_volume</span></code></a>()</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.Balloon_Simulator.set_flow_in" title="pvp.controller.control_module.Balloon_Simulator.set_flow_in"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_flow_in</span></code></a>(Qin, dt)</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.Balloon_Simulator.set_flow_out" title="pvp.controller.control_module.Balloon_Simulator.set_flow_out"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_flow_out</span></code></a>(Qout, dt)</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.Balloon_Simulator.update" title="pvp.controller.control_module.Balloon_Simulator.update"><code class="xref py py-obj docutils literal notranslate"><span class="pre">update</span></code></a>(dt)</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt id="pvp.controller.control_module.Balloon_Simulator.get_pressure">
<code class="sig-name descname">get_pressure</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#Balloon_Simulator.get_pressure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.Balloon_Simulator.get_pressure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.Balloon_Simulator.get_volume">
<code class="sig-name descname">get_volume</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#Balloon_Simulator.get_volume"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.Balloon_Simulator.get_volume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.Balloon_Simulator.set_flow_in">
<code class="sig-name descname">set_flow_in</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">Qin</span></em>, <em class="sig-param"><span class="n">dt</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#Balloon_Simulator.set_flow_in"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.Balloon_Simulator.set_flow_in" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.Balloon_Simulator.set_flow_out">
<code class="sig-name descname">set_flow_out</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">Qout</span></em>, <em class="sig-param"><span class="n">dt</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#Balloon_Simulator.set_flow_out"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.Balloon_Simulator.set_flow_out" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.Balloon_Simulator.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dt</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#Balloon_Simulator.update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.Balloon_Simulator.update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.Balloon_Simulator.OUupdate">
<code class="sig-name descname">OUupdate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">variable</span></em>, <em class="sig-param"><span class="n">dt</span></em>, <em class="sig-param"><span class="n">mu</span></em>, <em class="sig-param"><span class="n">sigma</span></em>, <em class="sig-param"><span class="n">tau</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#Balloon_Simulator.OUupdate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.Balloon_Simulator.OUupdate" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a simple function to produce an OU process on <cite>variable</cite>.
It is used as model for fluctuations in measurement variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>variable</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – value of a variable at previous time step</p></li>
<li><p><strong>dt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – timestep</p></li>
<li><p><strong>mu</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>)</em>) – mean</p></li>
<li><p><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – noise amplitude</p></li>
<li><p><strong>tau</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – time scale</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>value of “variable” at next time step</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.Balloon_Simulator._reset">
<code class="sig-name descname">_reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#Balloon_Simulator._reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.Balloon_Simulator._reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets Balloon to default settings.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="pvp.controller.control_module.ControlModuleSimulator">
<em class="property">class </em><code class="sig-prename descclassname">pvp.controller.control_module.</code><code class="sig-name descname">ControlModuleSimulator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">simulator_dt</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">peep_valve_setting</span><span class="o">=</span><span class="default_value">5</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleSimulator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleSimulator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleBase" title="pvp.controller.control_module.ControlModuleBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">pvp.controller.control_module.ControlModuleBase</span></code></a></p>
<p>Controlling Simulation.</p>
<p>Initializes the ControlModuleBase with the simple simulation (for testing/dev).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simulator_dt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><em>optional</em>) – timestep between updates. Defaults to None.</p></li>
<li><p><strong>peep_valve_setting</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Simulates action of a PEEP valve. Pressure cannot fall below. Defaults to 5.</p></li>
</ul>
</dd>
</dl>
<p><strong>Methods</strong></p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleSimulator.__SimulatedPropValve" title="pvp.controller.control_module.ControlModuleSimulator.__SimulatedPropValve"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__SimulatedPropValve</span></code></a>(x)</p></td>
<td><p>This simulates the action of a proportional valve.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleSimulator.__SimulatedSolenoid" title="pvp.controller.control_module.ControlModuleSimulator.__SimulatedSolenoid"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__SimulatedSolenoid</span></code></a>(x)</p></td>
<td><p>This simulates the action of a two-state Solenoid valve.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleSimulator.__init__" title="pvp.controller.control_module.ControlModuleSimulator.__init__"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code></a>([simulator_dt, peep_valve_setting])</p></td>
<td><p>Initializes the ControlModuleBase with the simple simulation (for testing/dev).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleSimulator._sensor_to_COPY" title="pvp.controller.control_module.ControlModuleSimulator._sensor_to_COPY"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_sensor_to_COPY</span></code></a>()</p></td>
<td><p>Make the sensor value object from current (simulated) measurements</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="pvp.controller.html#pvp.controller.control_module.ControlModuleSimulator._start_mainloop" title="pvp.controller.control_module.ControlModuleSimulator._start_mainloop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_start_mainloop</span></code></a>()</p></td>
<td><p>This is the main loop.</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleSimulator.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">simulator_dt</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">peep_valve_setting</span><span class="o">=</span><span class="default_value">5</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleSimulator.__init__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleSimulator.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes the ControlModuleBase with the simple simulation (for testing/dev).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simulator_dt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><em>optional</em>) – timestep between updates. Defaults to None.</p></li>
<li><p><strong>peep_valve_setting</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Simulates action of a PEEP valve. Pressure cannot fall below. Defaults to 5.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleSimulator.__SimulatedPropValve">
<code class="sig-name descname">__SimulatedPropValve</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pvp.controller.control_module.ControlModuleSimulator.__SimulatedPropValve" title="Permalink to this definition">¶</a></dt>
<dd><p>This simulates the action of a proportional valve.
Flow-current-curve eye-balled from generic prop vale with logistic activation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – A control variable [like pulse-width-duty cycle or mA]</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>flow through the valve</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleSimulator.__SimulatedSolenoid">
<code class="sig-name descname">__SimulatedSolenoid</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pvp.controller.control_module.ControlModuleSimulator.__SimulatedSolenoid" title="Permalink to this definition">¶</a></dt>
<dd><p>This simulates the action of a two-state Solenoid valve.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – If x==0: valve closed; x&gt;0: flow set to “1”</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>current flow</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleSimulator._sensor_to_COPY">
<code class="sig-name descname">_sensor_to_COPY</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleSimulator._sensor_to_COPY"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleSimulator._sensor_to_COPY" title="Permalink to this definition">¶</a></dt>
<dd><p>Make the sensor value object from current (simulated) measurements</p>
</dd></dl>

<dl class="py method">
<dt id="pvp.controller.control_module.ControlModuleSimulator._start_mainloop">
<code class="sig-name descname">_start_mainloop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#ControlModuleSimulator._start_mainloop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.ControlModuleSimulator._start_mainloop" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the main loop. This method should be run as a thread (see the <cite>start()</cite> method in <cite>ControlModuleBase</cite>)</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="pvp.controller.control_module.get_control_module">
<code class="sig-prename descclassname">pvp.controller.control_module.</code><code class="sig-name descname">get_control_module</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sim_mode</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">simulator_dt</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pvp/controller/control_module.html#get_control_module"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pvp.controller.control_module.get_control_module" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates control module.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sim_mode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – if <code class="docutils literal notranslate"><span class="pre">true</span></code>: returns simulation, else returns hardware. Defaults to False.</p></li>
<li><p><strong>simulator_dt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><em>optional</em>) – a timescale for thee simulation. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Either configured for simulation, or physical device.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ControlModule-Object</p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="coordinator.html" class="btn btn-neutral float-right" title="coordinator module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pvp.common.fashion.html" class="btn btn-neutral float-left" title="fashion" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, jonny saunders et al

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>